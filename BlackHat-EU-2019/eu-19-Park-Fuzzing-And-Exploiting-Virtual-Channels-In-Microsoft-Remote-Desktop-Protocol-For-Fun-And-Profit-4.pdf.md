Fuzzing and Exploiting Virtual Channels in Microsoft Remote Desktop Protocol for Fun and Profit

Chun Sung Park Yeongjin Jang

Seungjoo Kim* Ki Taek Lee
* Corresponding Author

ABOUT US
 Chun Sung Park
 Graduate student at SANE LAB, Korea University  Also a CTO of Diffense, Inc.
 Yeongjin Jang
 Assistant Professor of Computer Science, Oregon State University
 This work is partially supported by Institute for Information & communications Technology Promotion(IITP) grant funded by the Korea government(MSIT) (No.2018-0-00532,Development of High-Assurance(EAL6) Secure Microkernel)

ABOUT US
 Seungjoo (Gabriel) Kim (Corresponding Author, skim71@korea.ac.kr)
 Professor of Graduate School of Information Security, Korea University
 Ki Taek Lee
 Ph.D. candidate at SANE Lab, Korea University  Offensive security researcher and penetration tester at Samsung Research
 This work is partially supported by Institute for Information & communications Technology Promotion(IITP) grant funded by the Korea government(MSIT) (No.2018-0-00532,Development of High-Assurance(EAL6) Secure Microkernel)

AGENDA
 Motivation  Background: Recon on the official MS RDP client and its protocol  Finding Vulnerability Automatically: Build an RDP client fuzzer  Applying the RDP Client Fuzzer  Vulnerabilities  RDP Heap Feng Shui  Demo  Future work & Conclusion

MOTIVATION
 Hackers are using some RDP servers to shadow their IP address for attacks  Hacked windows servers in public are configured as an RDP server
 Attackers launch attacks from this computer by logging into the RDP server  Victims can only see the IP address of the RDP server
RDP SERVER

MOTIVATION
 Allegedly being used by many North Korean Hackers
 No proof, but from off-the-record discussions with security analysts
 Came up with a fun motivation:  Can we pwn RDP clients to launch attacks back to attackers?
RDP SERVER

MOTIVATION
 Disclaimer
 We did not use this techniques in public (yes, it's illegal)  We would like to share our journey for such a cool motivation in this presentation
RDP SERVER

Another Note
 Disclaimer
 Some part of this research project cannot be disclosed by the restrictions applied to one of the speakers (NDA-related)
 But, we will disclose as much as we can to entertain the audiences!

Recon on MS RDP client
 Need an understand the RDP protocol
 Requires two files to take a look at (via IDA Pro)
 Mstsc.exe  Mstscax.dll

Recon on MS RDP client
 Additional (human-readable) resources: publicly available documentations
 https://github.com/FreeRDP/FreeRDP/wiki/Reference-Documentation  56 documentations about RDP specification is out there

Recon on MS RDP client
 We may also get hints for the RDP protocol from one of the open-source implementation: FreeRDP
 https://github.com/FreeRDP/FreeRDP  Read the code, headers, data types, enums, etc. -> enables more efficient reversing

Recon on MS RDP client
 Latest Attack Case by CHECKPOINT  Attacked the clipboard channel : Ctrl C + Ctrl V
 A Path-traversal attack!  Poisoned RDP at BH USA 2019
 In contrast, our focus is at:
 Memory Corruption vulns in the MS RDP Client that allows Remote Code Execution

Recon on MS RDP client
 Available resources to the RDP client

Recon on MS RDP client
 How many (official) RDP Clients are there?
 5 types by OS/App
 mstsc.exe (native app)  Windows 10 app (AppContainer)  Android App  iOS App  macOS App

Recon on MS RDP client
 How many (official) RDP Clients are there?  5 types by OS/App
 mstsc.exe (native app)  Windows 10 app (AppContainer)  Android App  iOS App  macOS App
We assume all these implementation will share the same code base for the protocol

Our GOAL
 Find an exploitable memory corruption vulnerability in official RDP clients
 Popping shell from the RDP Client
 Need to find the part of the program that handles `memory' a lot
 Intuition: more code for handling memory, more memory corruption vulnerabilities!
 We purposely send malicious data from a compromised RDP Server to a client using virtual channels

What is Virtual Channel?

Virtual Channel Examples
 Default Channels

RDP Client

Clipboard Sound Output
Printers Smart Cards
... Echo drdynvc

RDP Server

Internally, handing of such features includes protocol parsing logic, lots of heap memory allocation/free,
etc., so it's a great target for fuzzing!

Virtual Channel Protocol
 Open Server  Open Channel  Read Channel  Write Channel  Close Channel  Close Server

Virtual Channel Protocol
 Open Server  Open Channel  Read Channel  Write Channel  Close Channel  Close Server

RDPSND CLIPRDR PRINTER SMARTCARD
....

Virtual Channel Protocol
 Open Server  Open Channel  Read Channel  Write Channel  Close Channel  Close Server

Virtual Channel Protocol
 Open Server  Open Channel  Read Channel  Write Channel  Close Channel  Close Server

Virtual Channel Protocol
 Open Server  Open Channel  Read Channel  Write Channel  Close Channel  Close Server

Virtual Channel Protocol
 Open Server  Open Channel  Read Channel  Write Channel  Close Channel  Close Server

Virtual Channel Protocol

 Open Server  Open Channel  Read Channel  Write Channel

hWTSSERVERHandle = WTSOpenServer("localhost"); hVirtualChannel = WTSVirtualChannelOpen(
hWTSSERVERHandle, WTS_CURRENT_SESSION, "RDPSND" );

 Close Channel  Close Server

buffer[0] = 0xa0; buffer[1] = 0xa1; buffer[2] = 0xa2; buffer[3] = 0xa3;

BufferSize = 4; bSuccess = WTSVirtualChannelWrite(hVirtualChannel, buffer, BufferSize, &bytesWritten);

Virtual Channel Protocol
 Open Server  Open Channel  Read Channel  Write Channel  Close Channel  Close Server

1. Run virtual channel write test program
2. Hooking mstscax!CChan::ChannelOnPacketReceived() Attacker Controllable Data, will be parsed by the client

Attack Scenario via Manipulating the Virtual Channel
 From server to client using virtual channel
 1) Open server  2) Open channel  3) Write channel  4) Send Malicious Data to Client

RDP Server

Malicious Data Virtual Channels

RDP Client

Finding Vulnerabilities Automatically: Build an RDP client fuzzer
 Requirements
 Need to hook Virtual Channels  Need to work with a server-client model  Need to apply a blackbox fuzzing  On Windows  But we would like to enable coverage-guided fuzzing (like AFL)! ...

Finding Vulnerabilities Automatically: Build an RDP client fuzzer
 Available coverage-guided fuzzing tool on Windows
 WinAFL !

Finding Vulnerabilities Automatically: Build an RDP client fuzzer
 WinAFL
 A fork of AFL for fuzzing Windows binaries
 afl-fuzz [afl options] -- [instrumentation options] -- target_cmd_line
 afl-fuzz.exe -i in -o out -D C:\work\winafl\DynamoRIO\bin64 -t 20000 -- coverage_module gdiplus.dll -coverage_module WindowsCodecs.dll -fuzz_iterations 5000 -target_module test_gdiplus.exe -target_offset 0x16e0 -nargs 2 -test_gdiplus.exe @@

WinAFL FUZZER

Apply mutation to the file

Run a target

TARGET PROGRAM

TEST CASE FILE
(cur_input)

Read file as input

Finding Vulnerabilities Automatically: Build an RDP client fuzzer
 WinAFL: slightly different with AFL
 afl-fuzz.exe -i in -o out -D C:\work\winafl\DynamoRIO\bin64 -t 20000 -- coverage_module gdiplus.dll -coverage_module WindowsCodecs.dll fuzz_iterations 5000 -target_module test_gdiplus.exe -target_offset 0x16e0 nargs 2 -- test_gdiplus.exe @@
 Need to specify target module and offset to hook the function and measure the code coverage

WinAFL

AFL

Finding Vulnerabilities Automatically: Build an RDP client fuzzer
 WinAFL
 It supports the following instrumentation modes:
 Dynamic instrumentation using DynamoRIO  Hardware tracing using Intel PT  Static instrumentation via Syzygy

Finding Vulnerabilities Automatically: Build an RDP client fuzzer
 WinAFL
 It supports the following instrumentation modes:
 Dynamic instrumentation using DynamoRIO
 Drawback: slow
 Hardware tracing using Intel PT  Static instrumentation via Syzygy

Finding Vulnerabilities Automatically: Build an RDP client fuzzer
 WinAFL
 It supports the following instrumentation modes:
 Dynamic instrumentation using DynamoRIO  Hardware tracing using Intel PT
 Drawback: need a CPU that supports PT, and cannot run fuzzer in the VM
 Static instrumentation via Syzygy

Finding Vulnerabilities Automatically: Build an RDP client fuzzer
 WinAFL
 It supports the following instrumentation modes:
 Dynamic instrumentation using DynamoRIO  Hardware tracing using Intel PT  Static instrumentation via Syzygy
 Drawback: some restrictions..

Finding Vulnerabilities Automatically: Build an RDP client fuzzer
 We decided to work with DynamoRIO with in-app persistent mode

Finding Vulnerabilities Automatically: Build an RDP client fuzzer
 The fuzzer architecture for fuzzing RDP client (a modified version of WinAFL)
 Client
 run winafl with mstsc.exe and hook mstscax.dll (for data receiving function)

 Check code coverage, mutate seed files

 Make a Cur_input file

 Send Cur_input file to server

 Server

Loop

 Run a program that

 Receive Cur_input file from WinAFL

 The content of cur_input will be sent through the

virtual channel

Finding Vulnerabilities Automatically: Build an RDP client fuzzer
 Original Architecture of WinAFL

RDP Client PC

Make mutated file

WinAFL FUZZER

Run a target
Executes everytime

TARGET PROGRAM

TEST CASE FILE
(cur_input)

Read file as input

Finding Vulnerabilities Automatically: Build an RDP client fuzzer
 Modified WinAFL for fuzzing the RDP client

RDP Client PC

Apply mutation to files and send it to the server

RDP WinAFL FUZZER

Executes just 1 time mstsc.exe mstscax.dll

Virtual Channels

RDP Server PC
Server Sends cur_input

Loop constructed by the in-app persistent mode

Applying the RDP Client Fuzzer
 Fuzzing mstsc.exe On Windows With WinAFL via Virtual Channels in RDP
 First target : RDPSND
 A channel enabled by default by mstsc.exe  One-way communication as audio playback is run by server and played in the client  Very simple protocol
 Note: other channels (Clipboard, etc.) are two-way channels

Applying the RDP Client Fuzzer
 Fuzzing mstsc.exe On Windows With WinAFL
 RDPSND : Audio Output Virtual Channel

Applying the RDP Client Fuzzer
 Fuzzing mstsc.exe On Windows With WinAFL
 RDPSND : Audio Output Virtual Channel

Applying the RDP Client Fuzzer
 Fuzzing mstsc.exe On Windows With WinAFL

Applying the RDP Client Fuzzer
 Fuzzing mstsc.exe On Windows With WinAFL
 RDPSND : Audio Output Virtual Channel  How to get a seed file for fuzzer?
 Hooking and Logging
msgType

Applying the RDP Client Fuzzer
 Fuzzing mstsc.exe On Windows With WinAFL
 RDPSND : Audio Output Virtual Channel
In FreeRDP Client Source code

Applying the RDP Client Fuzzer

 Fuzzing mstsc.exe On Windows With WinAFL

 Next targets

In FreeRDP Client Source code

 Other Channels
 Drdynvc  Printer  Smartcard ...

Applying the RDP Client Fuzzer
 Demonstration : RDP Client Fuzzer
 Running on Windows 7  1 Core  2G Memory  2 VMs are required
 One for RDP Client  One for RDP Server

Running the RDP Client Fuzzer
 Fuzzing setup
 Both the RDP Client and the RDP Server runs in each VM  Running on Windows 7  1 Core  2G Memory  2 VMs are required
 One for RDP Client  One for RDP Server
 The first vulnerability was found within 2 hours of running the RDP Client Fuzzer!
 We keep reporting vulnerabilities to MS

Detecting Heap Vulnerabilities
 We may use PageHeap; allocate each heap object in a new page
 gflags.exe /p /enable mstsc.exe /full  Slow, but this will generate crash if any heap error happens during fuzzing..
MSDN Article: The Structure of a Page Heap Block

VULNERABILITY & EXPLOIT

 RDP Client vulnerabilities on Windows in 2019

Category
CVE-2019-1333

Title
Remote Desktop Client Remote Code Execution Vulnerability

Author
Yongil Lee of Diffense

Date
2019.10.08

CVE-2019-1291 CVE-2019-1290 CVE-2019-0788 CVE-2019-0787 CVE-2019-1108 CVE-2019-0887

Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Protocol Client Information Disclosure Vulnerability

Microsoft Platform Security Assurance & Vulnerability
Research
Microsoft Platform Security Assurance & Vulnerability
Research
Microsoft Platform Security Assurance & Vulnerability
Research
Microsoft Platform Security Assurance & Vulnerability
Research
RDP_HACKER

Remote Desktop Client Remote Code Execution Vulnerability

Eyal Itkin of Check Point Research

2019.09.10 2019.09.10 2019.09.10 2019.09.10 2019.07.09 2019.07.09

Report by Checkpoint

Ref
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1333
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1291
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1290
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-0788
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-0787
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1108
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-0887

Threat No
T1 T2 T3 T4 T5 T6 T7

VULNERABILITY & EXPLOIT

 RDP Client vulnerabilities on Windows in 2019

Category
CVE-2019-1333

Title
Remote Desktop Client Remote Code Execution Vulnerability

Author
Yongil Lee of Diffense

Date
2019.10.08

CVE-2019-1291 CVE-2019-1290 CVE-2019-0788 CVE-2019-0787 CVE-2019-1108 CVE-2019-0887

Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Protocol Client Information Disclosure Vulnerability

Microsoft Platform Security Assurance & Vulnerability
Research
Microsoft Platform Security Assurance & Vulnerability
Research
Microsoft Platform Security Assurance & Vulnerability
Research
Microsoft Platform Security Assurance & Vulnerability
Research
RDP_HACKER

Remote Desktop Client Remote Code Execution Vulnerability

Eyal Itkin of Check Point Research

2019.09.10 2019.09.10 2019.09.10 2019.09.10 2019.07.09 2019.07.09

Ref
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1333
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1291
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1290
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-0788
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-0787
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1108
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-0887

No comment on: CVE-2019-1108; guess who reported this

Threat No
T1 T2 T3 T4 T5 T6 T7

VULNERABILITY & EXPLOIT

 RDP Client vulnerabilities on Windows in 2019

Category
CVE-2019-1333

Title
Remote Desktop Client Remote Code Execution Vulnerability

Author
Yongil Lee of Diffense

Date
2019.10.08

Ref
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1333

CVE-2019-1291 CVE-2019-1290 CVE-2019-0788 CVE-2019-0787 CVE-2019-1108 CVE-2019-0887

Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Protocol Client Information Disclosure Vulnerability

Microsoft Platform Security Assurance & Vulnerability
Research
Microsoft Platform Security Assurance & Vulnerability
Research
Microsoft Platform Security Assurance & Vulnerability
Research
Microsoft Platform Security Assurance & Vulnerability
Research
RDP_HACKER

Remote Desktop Client Remote Code Execution Vulnerability

Eyal Itkin of Check Point Research

2019.09.10 2019.09.10

https://portal.msrc.microsoft.com/en-US/security-
guidance/advisory/CVE-2019-1291
??? MSRC
https://portal.msrc.microsoft.com/en-US/security-
guidance/advisory/CVE-2019-1290

2019.09.10

https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-0788

2019.09.10

https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-0787

2019.07.09

https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1108

2019.07.09

https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-0887

Threat No
T1 T2 T3 T4 T5 T6 T7

VULNERABILITY & EXPLOIT

 RDP Client vulnerabilities on Windows in 2019 He is my boss

Category

Title

Author

Date

Ref

CVE-2019-1333

Remote Desktop Client Remote Code Execution Vulnerability

Yongil Lee of Diffense

2019.10.08

https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1333

CVE-2019-1291 CVE-2019-1290 CVE-2019-0788 CVE-2019-0787 CVE-2019-1108 CVE-2019-0887

Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Client Remote Code Execution Vulnerability
Remote Desktop Protocol Client Information Disclosure Vulnerability

Microsoft Platform Security Assurance & Vulnerability
Research
Microsoft Platform Security Assurance & Vulnerability
Research
Microsoft Platform Security Assurance & Vulnerability
Research
Microsoft Platform Security Assurance & Vulnerability
Research
RDP_HACKER

Remote Desktop Client Remote Code Execution Vulnerability

Eyal Itkin of Check Point Research

2019.09.10 2019.09.10 2019.09.10 2019.09.10 2019.07.09 2019.07.09

https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1291
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1290
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-0788
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-0787
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1108
https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-0887

Threat No
T1 T2 T3 T4 T5 T6 T7

VULNERABILITY & EXPLOIT

 RDP Client vulnerabilities on Windows in 2019 He is my boss

Category

Title

Author

Date

Ref

CVE-2019-1333

Remote Desktop Client Remote Code Execution Vulnerability

Yongil Lee of Diffense

2019.10.08

https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1333

CVE-2019-1291 CVE-2019-1290 CVE-2019-0788 CVE-2019-0787 CVE-2019-1108 CVE-2019-0887

Remote Desktop Client Remote

Microsoft Platform Security

https://portal.msrc.microsoft.com/en-US/security-

For the next, we will describe how to exploit the Code Execution Vulnerability

Assurance & Vulnerability Research

2019.09.10

guidance/advisory/CVE-2019-1291

Remote Desktop Client Remote

Microsoft Platform Security

https://portal.msrc.microsoft.com/en-US/security-

vulnerability found by our RDP Client Fuzzer, Code Execution Vulnerability

Assurance & Vulnerability Research

2019.09.10

guidance/advisory/CVE-2019-1290

by combining information leak and remote code Remote Desktop Client Remote Code Execution Vulnerability

Microsoft Platform Security Assurance & Vulnerability

2019.09.10

https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-0788

Research

execution vulnerabilities... Remote Desktop Client Remote
Code Execution Vulnerability

Microsoft Platform Security Assurance & Vulnerability

2019.09.10

https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-0787

Research

Remote Desktop Protocol Client Information Disclosure Vulnerability

RDP_HACKER

2019.07.09

https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-1108

Remote Desktop Client Remote Code Execution Vulnerability

Eyal Itkin of Check Point Research

2019.07.09

https://portal.msrc.microsoft.com/en-US/securityguidance/advisory/CVE-2019-0887

No comment on: CVE-2019-1108; guess who reported this

Threat No
T1 T2 T3 T4 T5 T6 T7

Vulnerabilities and Exploit
 We will break the ASLR in the RDP client
 We will achieve RCE in the RDP client
 The RCE vulnerability is a heap vulnerability
 We need to manipulate heap objects
 Need heap feng shui

RDP Heap Feng Shui
 Exploiting a DRDYNVC Channel  DRDYNVC is a dedicated channel for delivering dynamic data

RDP Heap Feng Shui
 In the DRDYNVC Channel
...

In FreeRDP Client Source code

RDP Heap Feng Shui
 Heap Control Primitives in the DRDYNVC Channel
 DATA_FIRST_PDU  Calling buf = malloc(size)

in drdynvc_process_data_first()

In Stream_new()

In dvcman_receive_channel_data_first() In StreamPool_Take()

RDP Heap Feng Shui
 Heap Control Primitives in the DRDYNVC Channel
 DATA_FIRST_PDU  Calling buf = malloc(size)

drdynvc_process_data_first() dvcman_receive_channel_data_first()
StreamPool_Take()

DATA_PDU
dvcman_receive_channel_data()
Malloc(size)

RDP Heap Feng Shui
 Heap Control Primitives in the DRDYNVC Channel
 DATA_PDU  Calling memcpy(buf,input,size)

In dvcman_receive_channel_data()

RDP Heap Feng Shui
 Heap Control Primitives in the DRDYNVC Channel
 DATA_PDU  Calling memcpy(buf,input,size)

dvcman_receive_channel_data() Stream_Copy()

Memcpy(input,Buf,Size)

RDP Heap Feng Shui
 Heap Control Primitives in the DRDYNVC Channel
 Close Channel  Calling free(buf)
dvcman_channel_free()

Exploitation
 Combining Information Leak & RCE vulnerabilities  This part has been removed due to the restriction of one of our speakers
 NDA...
 But, after having an arbitrary control over malloc(), memcpy(), and free()
 We can do feng shui to spray the data and manipulate heap objects to achieve arbitrary code execution
 Fairly standard after following RDP Heap Feng Shui primitives
Please do not be disappointed, we will show you a demo of the full-chain RCE exploit!

DEMO
 Exploiting an Information Leak vulnerability (guess which CVE it is!)  Use of Uninitialized memory; affected to:
 Mstsc.exe  Windows 10 app  Android App  iOS App  macOS App
 All five RDP clients (MS official)!
Our assumption on sharing the code base among those seems true! Fuzz mstsc.exe and pwn four more!

DEMO
 Exploiting an Information Leak vulnerability (guess which CVE it is!)  Use of Uninitialized memory; affected to:
 Mstsc.exe  Windows 10 app  Android App  iOS App  macOS App
 All five RDP clients (MS official)!
Our assumption on sharing the code base among those seems true! Fuzz mstsc.exe and pwn four more!

DEMO
 Breaking ASLR (guess which CVE it is!)
 Mstsc.exe on windows 7  We will demonstrate how we can break the ASLR of the client machine by launching a
memory leak attack.

DEMO
 Remote Code Execution
 Mstsc.exe on windows 7  Using RDP Heap Feng Shui
 Leak memory to break ASLR  Allocate heap objects in a pretty good construction  Hijacking a vtable of an object and launch Return-oriented Programming (ROP)
 Pops a calc.exe!

FUTURE WORK
 Fuzzing on other channels
 Drdynvc  Printer  Smartcard ...
 Need to handle two-way communication
 Modifying the program at the server is required

FUTURE WORK & Conclusion
 We have learned coverage-guided fuzzing to
 Windows Application  Server-client model  Applications with no source code available  Without modifying the binary program (no requirement for syzygy)

FUTURE WORK & Conclusion
 We have learned coverage-guided fuzzing to
 Windows Application  Server-client model  Applications with no source code available  Without modifying the binary program (no requirement for syzygy)
 Don't be afraid the application runs over server-client and does not accept file input

THANKS
 Q&A

DEMO
 RDP CLIENT FUZZER

DEMO
 RDP CLIENT FUZZER

THANKS
 Q&A

