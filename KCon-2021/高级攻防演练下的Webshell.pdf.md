WEBSHELL

About Me
  BeichenDream;  360--  JVM  
0 1

01
PART 01 

02
PART 02 


CONTENTS

03
PART 03 

04

05

06

07

PART 04

PART 05

PART 06

Java Agent 

PART 07 

0 1

PART.01 
 
0 2


 WAF    



webshell 

 0 1

Html
shellshell  


1. post 2. rsv_t 3. shell rsv_t 4. 

0 1

Html
shellshell  

 5. shell

0 1

Html
shellshell  

 6.  

0 1

Json
shellshell  

Json
1. json 2. shell 3.  encrypt 4. 

0 1

Json
shellshell  

Json 5. encrypt 6. Payloadresult->user 7. resultjson

0 1

json
shellshell  

Json 9.  

0 1

 shellshell  
0 1

PART.02 Webshell
 Pty    
0 2

Pty shell  Linuxpython pty  Windows Winpty & shellhost  jeditermPty
0 1

  BadPotato  SweetPotato  EfsPotato

 IISToken Potato  token
 Mimikatz   
 pe_to_shellcode

0 1

  /pid    x86/x64
0 1

Mimikatz    shellcode  msf/cs
0 1

PART.03 
 asp.net(iis) MVC  Java Agent   
0 2

asp.net(iis)       
0 1

asp.net(iis)   asp.netPage Resource HostingEnvironment.VirtualPathProvider.GetCacheKeyKey
0 1

asp.net(iis)   HostingEnvironment.VirtualPathProvider  
0 1

asp.net MVC   MVC  GetCacheKey  .NET3.5System.Web.Routing.RouteTable.Routes MVCGetRouteData    GetRouteData
0 1

Javaagent  Java Agent  JDKtools  JDK9JDK  JDK9agent
0 1

jdk tools GodzillaAgent Java tools native MachineMachine
0 1

  Java webservlet-api  servlet-api Servlet,Filter, Listener 
 ,HookServlet,Filter  Tomcat,Weblogic,Jboos,WebSphere,Jetty  
0 1



1. Godzilla Agent Jar 2. Godzilla Agent 3. bashGodzilla Agent Jar

0 1

PART.04 Java
 bypass jdk16 security module  bypass jdk reflection Filter
0 2

Java16
 Java16  module-info  
  jdk16  tomcatThread jdk16 
0 1

Java16
bypass jdk16 security module
ClassUnsafe.objectFieldOffset Class Unsafe.getAndSetObjectClass Class  
0 1

Java Reflection Filter
 Jdk 12-17   Exp

jdk.internal.reflect.Reflection

0 1

Java Reflection Filter
Reflection Filter methodFilterMapfieldFilterMap class  unsafe ApimethodFilterMapfieldFilterMap
0 1

PART.05 Agent
 JNIRasp  ClassRasp
0 2

JNIRasp  JNI native PASS  Webnative YES  Rasp
0 1

ClassRaspjavajvmti

jvmti

Jvm

Jvmti 0 1

ClassRaspJNI 1. /proc/self/mapsso 2. Elf+so= 3. 
0 1

ClassRaspcppshellcode          x32pic



0 1

ClassRaspcppshellcode 1. o 2. o 3. 
0 1

ClassRasppatchVM

 JVMJavaAgent

 JAVAAgentnativeeventHandlerClassFileLoadHookClassFileLoadHook

 JavaJVMeventHandlerClassFileLoadHook

 nativeAgenteventHandlerClassFileLoadHook

 eventHandlerClassFileLoadHookgetJ PLISEnvironmentJPLISEnvironment

 getJPLISEnvironmentjvmtienv->GetEnvironmentLocalStorage JPLISEnvironment

 environmentNULL Javatransform Agent Hook

0 1

ClassRasppatchVM
 UnHookAgent"" 1. Hook Java InstrumentationImpl Hack 2. Hook Java TransformerManager Hack 3. Hook Native Cool
 JavaUnHookAgent 0 1

ClassRasppatchVM Hook Java Agent Hook Native GetEnvironmentLocalStorageenvironmentNULL environmentNULLJavatransform Hook GetEnvironmentLocalStorage 
0 1

ClassRaspnative
1.   2. JVM 3. 
0 1

ClassRaspJava UnHook   Jar Hook OpenRasp
0 1

0 1

ClassRasp
 JDK Java  patchVM AgentJVM  RaspRasp  Rasp

Java Op en J DK Or acleJ DK ZuluJDK
jrockit
SapMachine Micr o so f t Kona JDK Liberica JDK J DK

 6+ 6+ 6+
6+
6+ 6+ 6+ 6+ 6+

Support Bypass Agent   

   
0 1


PART.06 
 Http Chunk  
0 2

Http chunk
Chunked transfer encoding HTTP HTTP  
0 1

Http chunk

 1.  2. Http 3.  4. 
 1. 

0 1

Http chunk

Http Chunk Chunk-Proxy

0 1

Chunk-proxyWeb


To mcat Web lo gic Jboos Re sin


J ava J ava J ava J ava


   



C h u n k- p roxy

   

   

J et t y

J ava







w eb sp h er e

J ava







glassf ish

J ava







0 1

IIS

C#









 I/O Socket  
     Socks
 

0 1

C2
0 1

PART.07 
 Api Mimikatz
0 2

 
0 1

 1.  shells.plugins. 2.  Swing Panel
0 1

 IDEA
0 1

 1. PluginAnnotation 2. Plugin 3.  4. Mimikatz
0 1


1. runButton 2. getPluginShellcodeLoader 3. Mimikatz 4. ShellcodeLoaderPE 5. resultTextArea
0 1

 1. jar 2. godzilla
0 1

  -> 
0 1

 KconMimikatz RunMimikatz
0 1


https://github.com/BeichenDream/Godzilla Rasp  https://github.com/BeichenDream/Kcon2021Code JDK  https://github.com/BeichenDream/Kcon2021Code Chunk-Proxy  https://github.com/BeichenDream/Chunk-Proxy GenericAgentTools  https://github.com/BeichenDream/GenericAgentTools Java https://github.com/BeichenDream/GodzillaWebAgent


KCon 
MA N O E U VR E

