ZIGBEE  EXPLOITED -- The  good,  the  bad  and  the  ugly

WHAT  IT'S  ABOUT?

AGENDA

 Introduction
 ZigBee  Security  
-- The  good
 ZigBee  Application P  rofiles
-- The  bad
 ZigBee  Implementations  
-- The  ugly
 Demonstration
 Summary

INTRODUCTION

WHO  ARE  WE?

 Tobias  Zillner  Senior I  S  Auditor @  Cognosec  
in  Vienna
 Penetration T  esting,  
Security  Audits, S  ecurity  
Consulting
 Breaking s  tuff  Owner  of  a  ZigBee  based  
home  automation s  ystem :  D

 Sebastian  Strobl  Principal A  uditor @  Cognosec  
in  Vienna
 Plans  and l  eads v  arious  
types  of  IT  audits
 Still t  rying  to  get  his  HD  
drone v  ision t  o w  ork
 Now  uses  Z--Wave  for h  ome  
automation u  ntil w  e m  anage  
to  break i  t  too

WHAT  IS  ZIGBEE?

ZigBee

Based o  n  IEEE   802.15.4 Low--cost
Low--power Two--way Reliable Wireless

WHERE  IS  IT  USED?

Home   Automation

Health   Care

Building   Automation

Smart   Energy
Retail   Services

Remote   Control

ZigBee Application  
Domains

Telecom   Services

WHY  IS  IT  IMPORTANT?

Number  of  IoT  Devices

30,000,000,000

26  

billion

25,000,000,000

20,000,000,000

15,000,000,000

10,000,000,000 5,000,000,000 0

0.9   billion
2009

2020

 Trend i  s  wireless  connections
 Samsung C  EO  BK  Yoon:  
 "Every  Samsung  device w  ill  be  
part  of  IoT  till 2  019" 3
 Over  500  smart  device  per  
household i  n 2  022  1

1 http://www.gartner.com/newsroom/id/2839717 2 http://www.gartner.com/newsroom/id/2636073 3 http://www.heise.de/newsticker/meldung/CES--Internet--der--Dinge--komfortabel--verne tzt--2512856.html

FUTURE  OF  WIRED  IOT
https://hivizme.files.wordpress.com/2012/06/cable--mess.jpg

WHY  SECURITY?

 HOME automation   has  high  privacy   requirements
 Huge  source o  f   personalized  data

" Items of interest will be located, identified, monitored, and remotely controlled through technologies such as radiofrequency identification, sensor networks, tiny embedded servers, and energy harvesters - all connected to the next" generation internet1 --Former C  IA  Director  
David P  etraeus

1  http://www.wired.com/2012/03/petraeus--tv--remote/

ZIGBEE  SECURITY -- THE  GOOD

ZIGBEE  SECURITY
ZigBee Security

Symmetric  

Message  

Encryption Authentication

Integrity Protection

Replay   Protection

ZIGBEE  SECURITY
 Based  on  "Open T  rust" m  odel
 The  layer t  hat o  riginates a   f  rame  is  responsible f  or s  ecuring i  t
 One  security  level p  er  network  Security  based  on  encryption k  eys
 Network  Key
 Used  for b  roadcast c  ommunication  Shared a  mong  all d  evices
 Link  Key
 Used  for s  ecure  unicast c  ommunication  Shared o  nly b  etween t  wo  devices

SECURITY  ARCHITECTURE
ZigBee  security  architecture  is  dependent  on:
 Safekeeping  of  the  symmetric  keys  Key p  rotection m  echanisms  employed  Implementation o  f t  he  cryptographic  mechanisms

SECURITY  ARCHITECTURE
Trust  in  the  security  is  ultimately  reduces  to:
 Trust  in  the  secure  initialization of  keying  material  Trust  in  the  secure  installation of  keying  material  Trust  in  the  secure  processing of  keying  material  Trust  in  the  secure  storage of  keying  material

HOW  ARE  KEYS  EXCHANGED?

Preinstalled Devices

Key Transport
 Out of band recommended

Key Establishment
 Derived from other keys  Also requires preinstalled
keys

ZIGBEE  APPLICATION P  ROFILES -- THE  BAD

APPLICATION P  ROFILES
 Define  communication b  etween d  evices  Agreements f  or  messages  Message  formats  Processing  actions
 Enable a  pplications t  o  Send  commands  Request d  ata  Process  commands  Process  requests
 Startup A  ttribute S  ets (  SAS)  provide i  nteroperability a  nd c  ompatibility

HOME  AUTOMATION
 Default T  rust  Center  Link K  ey
 0x5A  0x69  0x67  0x42  0x65  0x65  0x41  0x6C  0x6C  0x69  0x61  0x6E  
0x63  0x65  0x30  0x39  
 ZigBeeAlliance09
 Use  Default  Link K  ey  Join  
 0x01(True)  This  flag  enables t  he  use  of  default  link  key  join  as  a  fallback  case  
at  startup t  ime.
 Return t  o  Factory  Defaults  
 In support of a return to factory default capability, HA devices
shall implement a Network Leave service. Prior to execution of the NWK Leave [...] the device shall ensure all operating parameters are reset to allow a reset to factory defaults.

LIGHT  LINK
 Devices in a ZLL shall use ZigBee network layer
security.
 "The ZLL security architecture is based on using a
fixed secret key, known as the ZLL key, which shall be stored in each ZLL device. All ZLL devices use the ZLL key to encrypt/decrypt the exchanged network key. "
 "It will be distributed only to certified manufacturers
and is bound with a safekeeping contract"

LIGHT  LINK

LIGHT  LINK
 nwkAllFresh
 False    Do  not  check  frame  counter
 Trust  center  link k  ey
 0x5a  0x69  0x67  0x42  0x65  0x65  0x41  0x6c  0x6c  0x69  0x61  0x6e  
0x63  0x65  0x30  0x39  
 Default  key  for  communicating  with  a  trust  center
 Use  insecure  join
 True  Use  insecure j  oin  as  a  fallback  option.  

ZIGBEE  IMPLEMENTATIONS -- THE  UGLY

OFFICAL  STATEMENT
 "To avoid "bugs" that an attacker can use to
his advantage, it is crucial that security be well implemented and tested. [...] Security services should be implemented and tested by security experts [...]." (ZigBee Alliance 2008, p.
494)

ZBOSS
 ZigBee  Request K  ey  Security  Service
/** Remote device asked us for key.
Application keys are not implemented. Send current network key. Not sure: send unsecured? What is meaning of that command?? Maybe, idea is that we can accept "previous" nwk key? Or encrypt by it? */ /*
Initiate unsecured key transfer. Not sure it is right, but I really have no ideas about request- meaning of key for network key. */

TESTED D  EVICES
 Door  Lock  Smart  Home  System  Lighting S  olutions

RESULTS
 ALL  tested  systems  only  use  the  default  TC  Link  
Key  for  securing  the  initial  key  exchange
 No  link  keys  are  used  or  supported
 Complete c  ompromise a  fter g  etting n  etwork k  ey
 No  ZigBee  security  configuration  possibilities  
available
 No  key  rotation  applied
 Test  period o  f  11  month

RESULTS
 Device  reset  often  difficult
 Removal o  f  key  material n  ot g  uaranteed  One  device  does  not s  upport r  eset a  t  all
 Light  bulbs  do  not  require p  hysical  interaction  for  
pairing
 Workarounds l  ike  reduced  transmission  power  
are  used  to  prevent p  airing  problems
 Devices  have t  o b  e  in  very  close  proximity f  or p  airing

DEMONSTRATION -- SecBee

SecBee

 ZigBee  security  testing t  ool

 Target  audience  Security  testers  Developers

 Based o  n  scapy--radio and k  illerbee

 Provides f  eatures f  or t  esting o  f  security  services  as  well a  s  weak  
security  configuration a  nd i  mplementation

 Support o  f  encrypted  
communication
 Command i  njection  Scan  for  weak  key  
transport

 Reset  to f  actory  Join  to n  etwork  Test  request k  ey

DEMONSTRATION -- KEY  EXTRACTION

NETWORK  KEY  SNIFFING
1. Door  lock  will  be  added  to  the  system 2. Hub  is  going  to  be  paired  with  lock 3. Key  will  be  sent  to  lock 4. Exchange  will  be  sniffed

NETWORK  KEY  SNIFFING
Fallback  key  exchange  insecure
Most  vendors o  nly  implement   fallback  solution
Same  security  level  as  plaintext   exchange

VENDOR  COMMENT

NETWORK  KEY  SNIFFING So,  the 1. Timeframe  is  limited 2. Proximity  is  necessary 3. Key  extraction  works  only  during  pairing

WHAT  WOULD  AN  ATTACKER D  O?

Place  a   malicious   device n  ear   the  target   and  wait

Try  to  force   repairing

WHAT  WOULD  AN  ATTACKER D  O?

NETWORK  KEY  SNIFFING Jam  the  communication Wait  for  users  to  re--pair  the  device
 It  is  not  only  about  technology  :D

DEMONSTRATION -- DEVICE  TAKEOVER

DEVICE  TAKEOVER Devices  are  paired  and  working 1. Reset  to  factory  default  settings 2. Setup  own  network 3. Join  the  target  device  to  our  network

DEVICE  TAKEOVER
No  physical  access  is  required No  knowledge  of  the  secret  key  is  needed Usability  overrules  security

SUMMARY

SUMMARY
 Security  measures  provided a  re  
good
 Requirements d  ue t  o  
interoperability w  eaken  the   security  level d  rastically
 Vendors o  nly i  mplement t  he  
absolute m  inimum t  o  be   compliant
 Usability  overrules s  ecurity

BLACK  HAT  SOUND  BYTES
 Proper  implementation  of  security  measures  
is  crucial
 Learn  from  history  and  do  not  rely  on  
"Security  by  Obscurity"  
 There  is  a  world  beside  TCP/IP

THANK  YOU!

TIME  FOR  QUESTIONS -- LET'S  TALK  ABOUT  IT

Please  complete   the  speaker  feedback s  urvey
CONTACT
Tobias  Zillner Mobile: +43  664  8829  8290 Email: tobias.zillner@cognosec.com

