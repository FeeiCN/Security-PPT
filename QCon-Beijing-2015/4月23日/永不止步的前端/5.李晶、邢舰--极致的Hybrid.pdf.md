 Hybrid
---- Web  Native 
@ @
QCon 2015

   App 

Native & Web 
H5  Native 

H5

Native

52%

48%

Native

H5

Native & Web 

8
7.32
6
6
4

IOSs

Androids

2
0.5 0.8 0.2 0.3 0.240.4 0.2 0.4 0.010.01 0.1 0.2 0.1 0.2 0.3 0.4
0         

Native & Web 

IOSs
8

7.32 
6
6
4

Androids

2
0.5 0.8 0.2 0.3 0.240.4 0.2 0.4 0.010.01 0.1 0.2 0.1 0.2 0.3 0.4
0         

"So HTML/CSS/JS  App "

Thank you. Questions ?

Questions?
JS/CSS/IMG  
HTML 
 H5  Native  WebView  Crush  Native  Page 
HTML  ...


 "" ----   PD"" ----   "" ---- 

Hybrid

/



Web  Native  vs Native  Web 

Why Not Native
1. App (Native ) 2. (Native) 3. H5(Native) 4. App  H5 (Native)

Why not Web
1.  2. Wap 

Hybrid
    H5 vs  Native
H5 
   H5 

   /
Push/...
   M  V
Router ...


 HTML 4  HTML 5
  <a>    BOM Hybrid Bridge
 HTTP 1.1  HTTP 2.0(spdy?)
 +
  Browser  App
 App   URL Web""

Questions?
JS/CSS/IMG  
HTML 
 H5  Native  WebView  Crush  Native  Page 
HTML  ...

App

Hybrid Bridge

Webview 
 H5 



 

H5  Diff Controller BundleLoader

Config.json



 or QA

project-pkg.zip @ CDN

dist


grunt offline Grunt-flexcombo

Gitlab:proj/build_offline/

TMS

Combined HTML



Combined JS

Zip  Combined css Local img

Grunt-comboHTML Build offLine)

Gitlab:proj/src/

Juicer Mock

HTML

Pages/Mods/Widgets

ICON IMG

less/scss

JavaScript Files

IMGs

src

KISSY-Seed.js(v1.5.0) / KISSY-mini.js(v .x)

MPI
KISSY Gallery

 H5 

H5 ()

App

Hybrid Bridge

Webview 
 H5 



 

H5  Diff Controller BundleLoader

Config.json



 or QA

project-pkg.zip @ CDN

dist


grunt offline Grunt-flexcombo

Gitlab:proj/build_offline/

TMS

Combined HTML



Combined JS

Zip  Combined css Local img

Grunt-comboHTML Build offLine)

Gitlab:proj/src/

Juicer Mock

HTML

Pages/Mods/Widgets

ICON IMG

less/scss

JavaScript Files

IMGs

src

KISSY-Seed.js(v1.5.0) / KISSY-mini.js(v .x)

MPI
KISSY Gallery

 H5 

App 

H5 


Virtual Domain

cache_info.json
()




Native  App 

Safari:

App:

http://h5.m.taobao.com/trip/tuan/list/index.html
 URL 

Questions?
JS/CSS/IMG  
HTML  
H5  Native  WebView  Crush  Native  Page 
HTML  ...

TMS M  V 

 

TMS M  V 

handle_tms_fragment(function() {/* <section class="tms"> <style> #banner { width:100%; } </style> <div> <img src="http://gtms02.alicdn.com/tps/XX-640-200.png" > </div> </section>
*/}, 1);
 HTML 

<!-- #include file="extra.php" -->

<!-- #include file="extra.php" -->

<script id="tms_fragment_1"> get_tms_fragment("http://proxy.php?src=extra.php", "gbk", "1"); </script>

<!-- #include file="extra.php" -->
<script id="tms_fragment_1"> get_tms_fragment("http://proxy.php?src=extra.php", "gbk", "1"); </script>
 TMS 
handle_tms_fragment(function() { /*<div>TMS</div>*/
}, 1);

<!-- #include file="extra.php" -->
<script id="tms_fragment_1"> get_tms_fragment("http://proxy.php?src=extra.php", "gbk", "1"); </script>
handle_tms_fragment(function() { /*<div>TMS</div>*/
}, 1);

function handle_tms_fragment(fn, id) { var content = getFromComment(fn.toString()); //<div>TMS</div> $('tms_fragment_' + id).replaceWith(content);
}

src

clean

qa-seed-tmsparser.js

qa-seed.js

grunt build

less

sass

cssmin

kmb

uglify

replace

combohtml

domman

replace

cacheinfo

format zip

dist

src

clean

qa-seed-tmsparser.js

qa-seed.js

grunt build

less

sass

cssmin

kmb

uglify

replace

combohtml

domman

replace

cacheinfo

format zip

dist

Clam 

src

clean

qa-seed-tmsparser.js

qa-seed.js

grunt build

less

sass

cssmin

kmb

uglify

replace

combohtml

domman

replace

cacheinfo

format zip

dist

Cacheinfo.json 


Clamhttp://clam.alitrip.net

Questions?
JS/CSS/IMG  
HTML  
H5  Native  WebView  Crush  Native  Page 
HTML  ...

H5  @version
h5-taxi

build & push
gitlab
WD

h5-visa h5-car

&



QA

@version

pull

pull

User

update.zip



offline-config H5
@ gitlab

grip_gateway.php 
@ TMS

 H5 

H5 

&

@version

 h5-taxi

build & push

pull

h5-visa

 gitlab WD h5-car

/


offline-config H5
@ gitlab

/ QA
 @version
pull
update.zip


grip_gateway.php 
@ TMS

 H5 


User


Questions?
JS/CSS/IMG  
HTML  
H5  Native  WebView  Crush  Native  Page 
HTML  ...

Native

H5

H5

Native

Native

 App  Hybrid PageFlow 

Native

H5



Native

Native

 App 

1.  2. H5 Page 

H5 Page  Native Page 
1.  2. H5 Page 

H5 Page <meta>

H5

H5

Native H5
Native

Native H5

Native

Native

Native

 App  Hybrid PageFlow 

SPM + ttid
H5

SPM + ttid
H5

Native
SPM + ttid
H5
Native

Native

SPM + ttid
H5

Native

Native

Native

SPM  + ttid 

 H5  Native Page 



Questions?
JS/CSS/IMG  
HTML  
H5  Native  WebView  Crush  Native  Page 
HTML  ...

Bridge.js

App



Router
R

Apps

H5/PC

Router: //Push/

 App 

UI  
/   

Page   Crush 

Web         

Native         

ReactNative         

Hybrid  
      





UI  
/   

Page   Crush 

Web         

Native         

ReactNative         

Hybrid  
      

So
1.  FrontEnd 
 Web 
2.  Hybrid 

3.  H5  Native 
90% H5  Native 

H5 

Questions?
JS/CSS/IMG  
HTML 
 H5  Native  WebView  Crush  Native  Page 
HTML  ...

UI  
/   

Page   Crush 

Web         

Native         

ReactNative         

Hybrid  
      

Web

Native ReactNative Hybrid

UI 









JSVM HTML/CSS  

/



















VirtualDNS Native  "URL"





















Page  









Crush 









Web

Native


ReactNative Hybrid

UI 









JSVM HTML/CSS  

/



















VirtualDNS Native  "URL"





















Page  





 

Crush 









0 JavaScriptCore 0x3087852a JSC::LLInt::setUpCall(JSC::ExecState*, JSC::Instruction*, JSC::CodeSpecializationKind, JSC::JSValue, JSC::LLIntCallLinkInfo*) + 30 1 JavaScriptCore 0x3086f5b7 llint_slow_path_call + 123 2 JavaScriptCore 0x30873ef9 llint_op_call + 201 3 JavaScriptCore 0x30858b63 JSC::evaluate(JSC::ExecState*, JSC::SourceCode const&, JSC::JSValue, JSC::JSValue*) + 427 4 WebCore 0x37a480f7 WebCore::ScriptController::evaluateInWorld(WebCore::ScriptSourceCode const&, WebCore::DOMWrapperWorld*) + 255 5 WebCore 0x37a47fb7 WebCore::ScriptController::evaluate(WebCore::ScriptSourceCode const&) + 27 6 WebCore 0x37a47f2d WebCore::ScriptElement::executeScript(WebCore::ScriptSourceCode const&) + 325 7 WebCore 0x37afde33 WebCore::HTMLScriptRunner::executePendingScriptAndDispatchEvent(WebCore::PendingScript&) + 159 8 WebCore 0x37af709d WebCore::HTMLScriptRunner::executeParsingBlockingScripts() + 245 9 WebCore 0x37a532ff WebCore::HTMLDocumentParser::executeScriptsWaitingForStylesheets() + 27 10 WebCore 0x37a50585 WebCore::Document::didRemoveAllPendingStylesheet() + 41 11 WebCore 0x37b72005 WebCore::HTMLLinkElement::sheetLoaded() + 77 12 WebCore 0x37a5043b WebCore::StyleSheetContents::checkLoaded() + 99 13 WebCore 0x37b71949 WebCore::HTMLLinkElement::setCSSStyleSheet(WTF::String const&, WebCore::KURL const&, WTF::String const&, WebCore::CachedCSSStyleSheet const*) + 857 14 WebCore 0x37afeeb5 WebCore::CachedCSSStyleSheet::checkNotify() + 257 15 WebCore 0x37b71407 WebCore::CachedCSSStyleSheet::finishLoading(WebCore::ResourceBuffer*) + 219 16 WebCore 0x37af9d71 WebCore::SubresourceLoader::didFinishLoading(double) + 109 17 WebCore 0x37af9cd5 WebCore::didFinishLoading(_CFURLConnection*, void const*) + 125 18 CFNetwork 0x2f52d0e7 ___ZN27URLConnectionClient_Classic26_delegate_didFinishLoadingEU13block_pointerFvvE_block_invoke + 75 19 CFNetwork 0x2f52bcf7 ___ZN27URLConnectionClient_Classic18_withDelegateAsyncEPKcU13block_pointerFvP16_CFURLConnectionPK33CFURLConnectionClientCurrent_V MaxE_block_invoke_2 + 55 20 CoreFoundation 0x2f7fa8f1 CFArrayApplyFunction + 37 21 CFNetwork 0x2f4c36bb RunloopBlockContext::perform() + 183 22 CFNetwork 0x2f4c3579 MultiplexerSource::perform() + 221 23 CFNetwork 0x2f4c340d MultiplexerSource::_perform(void*) + 49 24 CoreFoundation 0x2f89220b __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 15 25 CoreFoundation 0x2f8916db __CFRunLoopDoSources0 + 207 26 CoreFoundation 0x2f88fecf __CFRunLoopRun + 623 27 CoreFoundation 0x2f7faebf CFRunLoopRunSpecific + 523 28 CoreFoundation 0x2f7faca3 CFRunLoopRunInMode + 107 29 WebCore 0x37a921ab RunWebThread(void*) + 419 30 libsystem_pthread.dylib 0x3a6a3919 _pthread_body + 141 31 libsystem_pthread.dylib 0x3a6a388b _pthread_start + 103 32 libsystem_pthread.dylib 0x3a6a1aa4 thread_start + 8
WebView Crash 

0 WebCore 0x00000001928a860c WebCore::CachedResource::unregisterHandle(WebCore::CachedResourceHandleBase*) + 144 1 WebCore 0x00000001928a856c WebCore::CachedResourceHandleBase::~CachedResourceHandleBase() + 32 2 WebCore 0x0000000192a0d6c4 WebCore::MemoryCache::pruneDeadResourcesToSize(unsigned int) + 352 3 WebCore 0x0000000192922de0 WebCore::MemoryCache::prune() + 128 4 WebCore 0x0000000192959aec WebCore::DocumentLoader::detachFromFrame() + 400 5 WebKitLegacy 0x00000001937c2b08 WebDocumentLoaderMac::detachFromFrame() + 20 6 WebCore 0x0000000192d5b914 WebCore::FrameLoader::detachFromParent() + 224 7 WebKitLegacy 0x0000000193829430 __29-[WebView(WebPrivate) _close]_block_invoke + 372 8 WebCore 0x00000001935f78b0 HandleRunSource(void*) + 368 9 CoreFoundation 0x0000000183f94240 __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 24 10 CoreFoundation 0x0000000183f9359c __CFRunLoopDoSources0 + 448 11 CoreFoundation 0x0000000183f91594 __CFRunLoopRun + 712 12 CoreFoundation 0x0000000183ebd2d4 CFRunLoopRunSpecific + 396 13 WebCore 0x0000000192920894 RunWebThread(void*) + 468 14 libsystem_pthread.dylib 0x0000000195fe3dc8 _pthread_body + 164 15 libsystem_pthread.dylib 0x0000000195fe3d24 _pthread_body + 0 16 libsystem_pthread.dylib 0x0000000195fe0ef8 thread_start + 4




JS 












 

 Hybrid 
App  WebView 

 Hybrid 
+4
WebView  + JSBridge

 Hybrid 
+4
WebView  + JSBridge

 Hybrid 
+47.
+4
WebView  + JSVM

WebView  + JSVM

navigation

NA

H5

WebView  + JSVM

JSVM

NA

H5

H5

HTML + CSS 
Native  CSS


HTML + CSS 
parserlayout

HTML + CSS 


 

parserlayout



HTML + CSS 
1.  2.  3. H5 

Questions?
JS/CSS/IMG  
HTML 
 H5  Native  WebView  Crush  Native  Page 
HTML  ...

Native  Page 
1.  URL  Page 

Page PageName

http://xxx.xxx.xxx/xxx/xxx.html

Native  Page 

1.  URL  Page  2.  DNS

NA

Native 

URL

VDNS

LH  H5 

RH  H5 

Native  Page 
1.  URL  Page  2.  DNS 3.  DNS
dns config

Native  Page 

router navi

A

B

C

D...

Page Flow

Native  Page 

vDns router
navi

A

B

C

D...

Page Flow

Native  Page 

vDns router
navi

A

B

C

D...

Page Flow

Native  Page 

vDns router
navi

A

B

C

D...

Page Flow

Native  Page 
1.  2. ABTest 3. HotPatch



ww

ww



ww

ww


1. JavaScript 
1. 2006~2010w3cYUIjQueryprototype... 2. 2009~2012 HTTP  DOM 
2. 
1. 2010~2013 2. 2012~2014commonJSrequireJSSeaJSAMDKMD
3. 
1. 2013~2014NodeJSRestful API BackEnd  FrontEnd 
4. Hybrid
1. 2015HTML5CSS3H5  Native NativeScriptReactNative 2. 2015JSVMVirtual DNS


 "" ----   PD"" ----   "" ---- 


 "" ----   PD"" ----   "" ---- 

""  App

 F2E  bachi@taobao.com

Thank You~

