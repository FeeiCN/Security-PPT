Intelligence Driven Malware Analysis (IDMA)
Malicious Profiling
14 January 2015

Homeland Security

National Cybersecurity and Communications Integration Center

whoami
 Cyber Threat Analyst at Northrop Grumman
o Performed wide range of duties from malware analysis to cyber threat reporting
o Supporting US-CERT/NCCIC
 B.S. in Digital Forensic Science from Defiance College (Ohio)
 M.S. in Digital Forensic Science from Champlain College (Vermont)
 Certifications
o GIAC Certified Reverse Engineer of Malware (GREM) o GIAC Certified Incident Handler (GCIH) o GIAC Certified Forensic Analyst (GCFA)

Homeland Security

Office of Cybersecurity and Communications
2

Outline
 Introduction & Purpose  Foundation & Origin  IDMA Overview  Critical Components  Operational Use Case  Conclusions

Homeland Security

Office of Cybersecurity and Communications
3

Introduction & Purpose
 Malware Analysis Integration
o Reduce operational isolation o Increase effectiveness of threat intelligence and
incident response operations
 Augment Existing Methodologies
o Not attempting to reinvent the wheel o Utilize threat intelligence to drive analysis

Homeland Security

Office of Cybersecurity and Communications
4

Foundation & Origin

 Diamond Model of  Facilitate a Bridge

Intrusion Analysis
(Caltagirone et al. 2013)

o Incident response o Malware analysis

 Robust and Scalable

o Threat intelligence

o Designed for incident response

o Adapted for malware analysis

Homeland Security

Office of Cybersecurity and Communications
5

Critical Components of IDMA
 Indicator Classification
o Novel concept o Provides context for analysis
 Indicator Correlation
o Novel concept o Facilitates actionable and relevant indicators
 Threat Intelligence Order of Volatility (TI-OV)
o Novel concept o Methodical order of precedence

Homeland Security

Office of Cybersecurity and Communications
6

Indicator Classification & Correlation

Homeland Security

 Hash values  Single IP address  Single domain

 Source and destination IP (net flow)
 Targeted ports and services
 Beacon addressed and locations
 Delivery methods

 File names  File paths  IDS signatures or other detection
methods  Intrusion objectives (if known)  Vulnerability identifiers

 File system interaction (create, change, delete)
 Registry interactions  Toolchain analysis (packer, compiler)  Impact and outcome
Office of Cybersecurity and Communications
7

Threat Intelligence Order of Volatility (TI-OV)

Homeland Security

Office of Cybersecurity and Communications
8

Profiles of Analysis
 Four Core Profiles (Analysis Methods)
o Static, Dynamic, Reversing, Adversary
 Segmented Analysis
o Reinforce existing methodologies o Multiple components = one profile o Modular system of analysis
 Critical Questions of Malicious Profiling
o Provides focus to core profiles o Drives analysis towards intelligence criteria

Homeland Security

Office of Cybersecurity and Communications
9

IDMA Profiles
The basic concept of malicious profiling leverages existing malware analysis techniques applied with critical thinking and intelligence analysis skills.

Modular analysis
Profiles can be individually or collectively applied to the diamond model to increase efficiency and focus analysis.

Homeland Security

Office of Cybersecurity and Communications
10

IDMA Concept

Homeland Security

Office of Cybersecurity and Communications
11

IDMA Process Flow

Homeland Security

Office of Cybersecurity and Communications
12

Use Case
 SATR Discovery
o Malware hashes beaconing to government hosts o Intelligence -> malware analysis -> incident
response
 IDMA Analysis
o Integration of efforts o IDMA project was a derivative of this effort

Homeland Security

Office of Cybersecurity and Communications
13

Homeland Security

Office of Cybersecurity and Communications
14

Use Case: Malicious Profile

TI-OV

Adversary Infrastructure Capabilities Victim

Behavioral

Anti-forensic techniques

Host Based

Network Based

Digital certificate domains

Sample signed with two digital
certificates
Malicious domain hardcoded

Public facing server URL
Designed to run on
Windows XP
Hosting IP address

Ephemeral Compile time

Sample hash Detection Time

(Zeltser, 2015)

Homeland Security

Office of Cybersecurity and Communications
15

Use Case: Correlating Evidence
 Original Work Flow
o Samples discovered o Net flow examined (limited scope) o Samples were sent to malware shop (little context provided)
 Callback domain  Net flow conclusions
 Total time invested ~10 days (prior to additional response)
 IDMA Work Flow
o Samples discovered o IDMA applied (context discovery) o Samples can be sent to malware shop
 Indicators from all 8 categories of the profile supplied
o Additional context can drive further analysis (malware, IRT)

Homeland Security

Office of Cybersecurity and Communications
16

Use Case: Correlating Evidence

 Original Work Flow  IDMA Work Flow

o Samples discovered

o Samples discovered

o Net flow examined (limited scope)

o IDMA applied (context discovery)

o Samples were sent to malware shop (little context provided)
 Callback domain
 Net flow conclusions
o Total time invested ~10 days (prior to additional response)

o Samples can be sent to malware shop
 Indicators from all 8 categories of the profile supplied
o Additional context can drive further analysis (malware, IRT)

Homeland Security

Office of Cybersecurity and Communications
17

Use Case Conclusions

 Full Scale Reverse Engineering
o Time consuming, resource intensive process o Few individuals are fully qualified
 IDMA Analysis
o Two profiles used (Static, Reversing) o Tools utilized
 OllyDbg  PEStudio  BinText
o Context driven analysis o Total time invested ~3 hours (additional)

Homeland Security

Office of Cybersecurity and Communications
18

Conclusions

Context
 Shift field away from single indicators
 Additional context increases effectiveness of incident response and threat intelligence operations
Malware Analysis & Diamond Model
 Sample analysis can feed all four components
 Malware analysis does not have to be compartmentalized & segregated
Homeland Security

Volatility
 Facilitates indicator precedence  Focus analysis on less volatile
indicators  Adds additional context for
reporting
Value of Time
 Context and behavior can be derived without full scale reversing
 Can lead to increased effectiveness in incident response operations
Office of Cybersecurity and Communications
19

Questions?

Homeland Security

Office of Cybersecurity and Communications
20

