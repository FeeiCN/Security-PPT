MALWARE'S ABUSE OF PRIVACY ENHANCING TECHNOLOGIES
BLAKE ANDERSON, PhD blake.anderson@cisco.com January 9, 2020

OUTLINE

 Motivation / Background  General malware PET's trends  Malware's abuse of censorship circumvention tools  Future trends

FloCon, Malware's Abuse of PETs

2

MOTIVATION / BACKGROUND

FloCon, Malware's Abuse of PETs

3

NETWORK THREAT LANDSCAPE

FloCon, Malware's Abuse of PETs

4

TLS 1.2

Client

Server

CLIENT HELLO

SERVER HELLO

CERTIFICATE

SERVER KEX

SERVER HELLO DONE

CLIENT KEX

CHANGE CIPHER SPEC

FINISHED

CHANGE CIPHER SPEC

FINISHED

APPLICATION DATA

FloCon, Malware's Abuse of PETs

5

TLS 1.3

Client
CLIENT HELLO SERVER HELLO CHANGE CIPHER SPEC
CHANGE CIPHER SPEC APPLICATION DATA APPLICATION DATA

Server
APPLICATION DATA

FloCon, Malware's Abuse of PETs

6

TLS CLIENT HELLO





HandshakeType:

01

 Length

0001fc







 ProtocolVersion: 0303







 

ClientRandom:

a19fdbf3...

 

 

SessionID:

06d18594...

 

 

CipherSuites:

0a0a...000a

 

 

CompressionMethods

0100

 

Extensions:

0000...

FloCon, Malware's Abuse of PETs

7

TLS CLIENT HELLO FINGERPRINTING





Process: chrome.exe

 ProtocolVersion: 0303

 Version:    SHA-256: 

76.0.3809.132  
5616...9acc  

a :  CipherSuites:

0a0a...000a    Category: browser







Extensions:

0000...

 

OS:

WinNT

 

 

OSversion:

10.0.17134

 

OSedition: Enterprise

FloCon, Malware's Abuse of PETs

8

DNS-OVER-HTTPS

Client

Preface

SETTINGS

WINDOW UPDATE

PRIORITY

PRIORITY

HEADERS (:path=/dns-query?dns=*)

PRIORITY

SETTINGS

WINDOW UPDATE

SETTINGS

HEADERS

DATA (application/dns-message)

Server

FloCon, Malware's Abuse of PETs

9

GENERAL TRENDS

FloCon, Malware's Abuse of PETs

10

MALWARE'S TLS USAGE

FloCon, Malware's Abuse of PETs

11

MALWARE'S TLS 1.3 USAGE

FloCon, Malware's Abuse of PETs

12

MALWARE'S DNS-OVER-HTTPS USAGE

 Currently, there are only a handful of malware-initiated DoH connections
 In the same dataset, we observed 1 million DNS flows per day

FloCon, Malware's Abuse of PETs

13

MALWARE'S ABUSE OF CENSORSHIP CIRCUMVENTION TOOLS

FloCon, Malware's Abuse of PETs

14

MALWARE'S ABUSE OF CENSORSHIP CIRCUMVENTION TOOLS

FloCon, Malware's Abuse of PETs

15

PSIPHON'S TLS FINGERPRINTS

 Randomly mimics Chrome/Firefox/Safari/iOS fingerprints  https://github.com/refraction-networking/utls/  u parrots.go
 Destinations typically use a word-based DGA  Common fingerprints often omit popular extensions (server name)

FloCon, Malware's Abuse of PETs

16

MALWARE'S ABUSE OF FINGERPRINT RANDOMIZATION

FloCon, Malware's Abuse of PETs

17

APPROXIMATE MATCHING

 (0303)(009dc02c0005)((0000)(002b)(002d))  (0303)(cca9000f0003c009)((0000)(002b)(002d))  Approximate matching can help!
 Edit distance is an intuitive measure

FloCon, Malware's Abuse of PETs

18

MALICIOUS VS BENIGN TOR USAGE

FloCon, Malware's Abuse of PETs

19

FUTURE TRENDS

FloCon, Malware's Abuse of PETs

20

TLS 1.3 - OS X

 Chrome/Firefox were initially the only applications supporting 1.3
 March 2019: MacOS 10.14.4/CoreTLS turn 1.3 on by default

FloCon, Malware's Abuse of PETs

21

DNS-OVER-HTTPS - Windows 10

 Enabling support sometime this year  Will use the system's DNS configuration  Will enforce DoH usage to DNS servers' supporting DoH

FloCon, Malware's Abuse of PETs

22

MALWARE AND SYSTEM DEFAULTS

FloCon, Malware's Abuse of PETs

23

CONCLUSIONS

 Malware continues to evade detection through:  TLS 1.0-1.3  Tor  More advanced obfuscation techniques
 As privacy enhancing technologies are turned on by default, malware's adoption will quickly follow
 https://github.com/cisco/mercury

FloCon, Malware's Abuse of PETs

24

THANK YOU!

