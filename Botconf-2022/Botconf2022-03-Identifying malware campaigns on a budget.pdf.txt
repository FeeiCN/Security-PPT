Identifying malware campaigns on a budget
MAX `LIBRA' KERSTEN & RENS VAN DER LINDEN

Table of contents
 Who are we?  Goal  Audience  Budget  Used data  Data normalisation  Modules  Questions

BOTCONF2022 -  MAX 'LIBRA' KERSTEN AND RENS 'KUIIL VAN DER LINDEN

2

Who am we?
o Max `Libra' Kersten (@Libranalysis)
o Working for Trellix' Advanced Threat Research team
o During the research I was part of ABN AMRO's Threat Intelligence team
o Spoke at several conferences
o Botconf, BlackHat, CONFidence, atHack, and others
o I write blogs about reverse engineering
o Including my own free Binary Analysis Course
o My tools are open-sourced on Github
o Such as m3 or AndroidProjectCreator

BOTCONF2022 -  MAX 'LIBRA' KERSTEN AND RENS 'KUIIL VAN DER LINDEN

3

Who are we?
 Rens van der Linden  Working at RSecure
 Penetration tester
 ABN AMRO's Threat Intelligence team
 Graduation internship
 Blog  Tooling open sourced on Github

BOTCONF2022 -  MAX 'LIBRA' KERSTEN AND RENS 'KUIIL VAN DER LINDEN

4

Goal

o "Gain continuous insight into malware campaigns on a budget"
o Selected criteria o Cross platform o Use as few resources as possible o Scalable o Reusable and repurposable o Pareto principle o Applicable in the real world

BOTCONF2022 -  MAX 'LIBRA' KERSTEN AND RENS 'KUIIL VAN DER LINDEN

5

Audience
o Applicable to o Students o Start-ups o Independent researchers o Corporations
o Useful in o Malware analysis o Threat intelligence o Incident response

BOTCONF2022 -  MAX 'LIBRA' KERSTEN AND RENS 'KUIIL VAN DER LINDEN

6

Budget
o Depends on the user's needs and background
o I.e. a corporate budget or a student
o Scaling requires improved hardware
o The Raspberry Pi 3B+ can still be used for other projects

ITEM
Raspberry Pi 3B+
Raspberry Pi 3B+ power usage
Software

COST
65
5 (3.5W, yearly 31 kWh, 0.15 per kWh)
FOSS

BOTCONF2022 -  MAX 'LIBRA' KERSTEN AND RENS 'KUIIL VAN DER LINDEN
7

Used data
o Anonymous source provided 500 000 malicious e-mails
o Unable to publish the given data set o The e-mails did not contain the mail body
o One can replicate the shown techniques with other e-mails o Public services are used to enrich the obtained data

BOTCONF2022 -  MAX 'LIBRA' KERSTEN AND RENS 'KUIIL VAN DER LINDEN

8

Data normalisation
 Combine modules to increase granularity  Reduce false positives
 User-controllable threshold  Flexible  Use-case of results

BOTCONF2022 -  MAX 'LIBRA' KERSTEN AND RENS 'KUIIL VAN DER LINDEN

9

Modules
 Widely adopted
 Modeling intrusion attempts
 Devises seven steps
 Achieve objectives
 Malware
 Steps 3 / 6

 E-mail containing a malicious

3

attachment is received

 User executes the malicious

4

macro inside the attachment

 Payload for the next stage is

5

retrieved and executed

 Command and control

6

channel is established

BOTCONF2022 -  MAX 'LIBRA' KERSTEN AND RENS 'KUIIL VAN DER LINDEN

10

E-mail subjects
 Identify e-mails sent out in bulk  Proactive search
 In contrast to a literal search  Levenshtein distance
 Number of character changes
BOTCONF2022 -  MAX 'LIBRA' KERSTEN AND RENS 'KUIIL VAN DER LINDEN

Source: researchgate
Source: ExecuteMalware
11

Lure images
 Disabling Office's Protected View  Enabling Macros
 Small changes  Cryptographic hashes
 Perceptual hashing algorithm  Average Hash
 Malicious document builders  Include pre-made lure image

BOTCONF2022 -  MAX 'LIBRA' KERSTEN AND RENS 'KUIIL VAN DER LINDEN

12

Lure images
o Cluster example

BOTCONF2022 -  MAX 'LIBRA' KERSTEN AND RENS 'KUIIL VAN DER LINDEN

13

URLs
 Purpose of the website
 Breached website
 Correlation does not mean causation
 Enumeration
 WHOis information  WordPress  URLHaus

Source: Abuse.ch's URLHaus

BOTCONF2022 -  MAX 'LIBRA' KERSTEN AND RENS 'KUIIL VAN DER LINDEN

14

Demo

BOTCONF2022 -  MAX 'LIBRA' KERSTEN AND RENS 'KUIIL VAN DER LINDEN

15

Malware families
 Group of malware
 Same codebase  Generic C&C traffic
 Actionable intelligence  Increases context

Source: Hatching Triage

BOTCONF2022 -  MAX 'LIBRA' KERSTEN AND RENS 'KUIIL VAN DER LINDEN

17

Questions
Contact us!
@Libranalysis /in/ThisIsLibra
@KuiilSec /in/RensvdLinden

