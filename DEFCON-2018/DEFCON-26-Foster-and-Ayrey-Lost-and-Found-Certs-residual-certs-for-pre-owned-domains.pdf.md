Lost and Found Certificates
Ian Foster & Dylan Ayrey

Who We Are
Ian
Information Security Engineer CertGraph https://dns.coffee https://lanrat.com https://github.com/lanrat @LANRAT

Dylan
truffleHog WPA2-HalfHandshake-Crack Pastejacking Other stuff... https://github.com/dxa4481 dylanayrey@gmail.com

The Problem

A certificate can outlive a the ownership of a domain
This potentially leaves the domain owner with a valid SSL certificate for the next owner
How can you know?
 Buy a new domain... hope for the best?  In the early 2000's and early 2010's, you'd never know

Alice registers foo.com for 1 year

foo.com unregistered

Alice's 3 year SSL certificate for foo.com

Bob registers foo.com Bob's certificate for foo.com

Certificate Transparency!
 Log of all certificates issued by public Certificate Authorities  Designed to catch bad or misbehaving Certificate Authorities  Publicly auditable and searchable  ½ billion certs and growing

We Can find pre-existing certificates
 Note the purchase date of said domain  Search CT logs for certs pre-dating that date and valid after  Monitor
 Old certs may not show up in logs for years, if ever

A significant example
stripe.com

How big is this issue?

Searched Certificate Transparency (CT) for certificates that overlap multiple domain registrations

Data
 3 million domains  1% of internet
 Looked for changes...  Expiration date  Email contacts  Registrar  Etc...

Sources
 CT logs  Historical WHOIS  Historical nameservers https://dns.coffee  WayBack Machine https://archive.org

1.5M (0.45%)
Of domains tested have pre-existing certificates
25% haven't expired yet

BygoneSSL
noun
An SSL certificate created before and supersedes its domains' current registration date

Could it be worse?

 Certificates can have many domains  Certificates can contain some bygone domains and some not

foo.com <bygone>

Cert foo.com bar.com

bar.com

CertGraph Example of BygoneSSL
https://github.com/lanrat/certgraph

Example: do.com

Can we revoke these certs?

If no....
 Spend 10k on a domain, you're screwed for years  Bad guys could squat on desirable domains  Cry

If yes...
 You can take down production certs you don't own  You can DoS companies

Digging deeper....
 Rules that dictate how CA's and browsers operate  If broken browsers distrust the CA
Baseline Requirements for the Issuance and Management of Publicly-Trusted Certificates

Can revoke if information becomes incorrect
https://cabforum.org/wp-content/uploads/CA-Browser-Forum-BR-1.5.7-29-Apr-2018.pdf

Within 24 hours
https://cabforum.org/wp-content/uploads/CA-Browser-Forum-BR-1.5.7-29-Apr-2018.pdf

We can DoS production sites

foo.com <bygone>

Cert foo.com bar.com

bar.com

Certificate for bar.com can be revoked because it is shared with foo.com which has changed ownership during the certificates lifetime

7M (2.05%)
Of domains share a certificate with bygone domains
41% haven't expired yet

Sounds like we can break stuff....

BygoneSSL

BygoneSSL Man in the Middle
If a company acquires a previously owned domain...
Previous owners could still have valid certificates
MitM the SSL connection with a certificate generated by the previous owner

BygoneSSL Denial of Service
If a certificate has a subject alt-name for a domain no longer owned...
Revoke the certificate with a vulnerable domain and non-vulnerable domain listed in the alternative names
You can DoS the service if the shared certificate is still in use!

Trying to revoke with Let's Encrypt
 Instant automated turn around  I emailed security@letsencrypt.org

Trying to revoke with Digicert
 1 day turn around  I emailed support@digicert.com

Trying to revoke with Amazon AWS
 1 week turn around  I emailed ec2-abuse@amazon.com

Trying to revoke with Comodo....
 Still waiting....  I opened many support chats and emailed security@comodo.com

What about resellers? (ssl's)
 1 week turn around  I emailed tech@ssls.com

Instantly revoked a cert used in production
 I still own and use security.love

BygoneSSL Certificate Transparency Log Monitor
Fork of SSLMate's CertSpotter Log Monitor Tool https://github.com/lanrat/certspotter
Watchlist file example: insecure.design valid_at:2018-04-18 defcon.org valid_at:1993-06-21 wikipedia.org valid_at:2001-01-13 toorcon.net valid_at:2012-03-13

BygoneSSL Facebook Search Tool
 Requires auth to Facebook  Faster! BygoneSSL Search https://github.com/dxa4481/bygonessl

Unanswered Questions
 How do you give notice when revolving a certificate to its alt-names?  How much notice?
 Revocation is broken a best....  Our demo certificate has been revoked for months, still works fine

Things you can do to protect your domain
 Use the Expect-CT HTTP header with enforce to ensure that only CT logged certs will be trusted for your domain  If a previous owners certificate is in CT logs, request the CA revoke it  Hope user checks CRL lists or OCSP
 We should continuously monitor CT logs for old certs
 CT has only been required for non-EV since April 2018  Only required for certificates issued after April
 Check currently owned domains as well for older certificates  Use CertSpotter with BygoneSSL to monitor logs

Things the internet can do
 Registrars could show pre-existing certificates for domain registrations  Include related alt-names
 CAs could only issue short lived certificates  Let's Encrypt!
 CAs should not issue certificates valid for longer than domain registration  Be careful with subject alt-names
 If you're a hosting client domains, check CRL's and replace certs as needed

Questions?
https://insecure.design CertSpotter https://github.com/lanrat/certspotter BygoneSSL Search https://github.com/dxa4481/bygonessl

